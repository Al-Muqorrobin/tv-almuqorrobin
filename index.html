<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Masjid Al-Muqorrobin - Full Features</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap');
        body, html { margin: 0; padding: 0; min-height: 100vh; font-family: 'Plus Jakarta Sans', sans-serif; background: #010409; color: white; overflow: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .glass-dark { background: linear-gradient(to top, rgba(0,0,0,0.98) 0%, rgba(0,0,0,0.4) 60%, transparent 100%); }
        .upcoming-prayer { 
            background: linear-gradient(135deg, #064e3b 0%, #059669 100%) !important;
            border: 2px solid #34d399 !important;
            animation: pulse-green 2s infinite;
        }
        @keyframes pulse-green { 0%, 100% { box-shadow: 0 0 0 0px rgba(52, 211, 153, 0.4); } 50% { box-shadow: 0 0 20px 5px rgba(52, 211, 153, 0.2); } }
        #slide-content-area { transition: opacity 0.6s ease-in-out; }
        .bar-fill { transition: height 1s ease-out; }
    </style>
</head>
<body class="flex flex-col h-screen p-3">

    <div id="loading" class="fixed inset-0 bg-[#010409] z-50 flex items-center justify-center">
        <div class="text-emerald-500 font-bold animate-pulse text-2xl">MEMUAT DATA...</div>
    </div>

    <header class="w-full px-4 py-2 flex justify-between items-center shrink-0 mb-3">
        <div class="flex items-center gap-4">
            <div id="logo-container" class="w-14 h-14 bg-emerald-600 rounded-2xl flex items-center justify-center text-3xl overflow-hidden">ðŸ•Œ</div>
            <div>
                <h1 id="nama-masjid" class="text-3xl font-extrabold uppercase leading-none tracking-tighter">MASJID</h1>
                <p id="alamat-masjid" class="text-emerald-400 text-[10px] font-bold tracking-[0.4em] mt-1 uppercase">LOKASI</p>
            </div>
        </div>

        <div class="flex-grow flex flex-col items-center justify-center">
            <div id="iqomah-container" class="hidden text-center bg-white/5 px-8 py-2 rounded-2xl border border-emerald-500/30">
                <p class="text-[10px] font-black uppercase text-emerald-400">Menuju Iqomah</p>
                <h2 id="iqomah-timer" class="text-4xl font-black text-white">00:00</h2>
            </div>
        </div>

        <div class="flex items-center gap-6">
            <div class="text-right">
                <div id="date" class="text-xl font-extrabold uppercase mb-1">...</div>
                <div id="countdown" class="text-yellow-400 text-lg font-black tracking-tighter">--:--:--</div>
            </div>
            <div id="clock" class="text-7xl font-black text-yellow-400 tabular-nums leading-none tracking-tighter border-l-4 border-white/10 pl-6">00:00:00</div>
        </div>
    </header>

    <main class="flex-grow flex flex-col lg:flex-row gap-4 overflow-hidden mb-2">
        <section class="order-2 lg:order-1 w-full lg:w-[74%] h-full relative rounded-[2.5rem] overflow-hidden glass">
            <div id="slide-content" class="w-full h-full relative opacity-0"></div>
        </section>

        <aside id="prayer-list" class="w-full lg:w-[26%] flex flex-col gap-2 h-full">
            </aside>
    </main>

    <footer class="w-full flex items-center bg-emerald-950/80 rounded-2xl border border-white/10 overflow-hidden shrink-0 shadow-2xl">
        <div class="bg-yellow-400 text-black font-black px-6 py-3 text-2xl skew-x-[-12deg] -ml-2">INFO</div>
        <marquee id="running-text" scrollamount="6" class="text-3xl font-extrabold text-yellow-400 uppercase">...</marquee>
    </footer>

    <script>
// Variabel Global (Default)
    let config = {
        nama_masjid: "MASJID",
        alamat_singkat: "Lokasi",
        logo: "",
        running_text: "Memuat data...",
        durasi_iqomah: 10,
        wilayah_sholat: "Bekasi",
        metode_api: "11"
    };

    let slidesData = [];
    let prayerTimes = {};

    async function initApp() {
        try {
            // 1. Ambil data dari JSON (GitHub)
            const res = await fetch('./data.json?t=' + new Date().getTime());
            const data = await res.json();
            
            // 2. Terapkan Pengaturan ke UI
            if(data.pengaturan) {
                config = data.pengaturan;
                document.querySelector('h1').innerText = config.nama_masjid;
                document.querySelector('p.text-emerald-400').innerText = config.alamat_singkat;
                document.querySelector('marquee').innerText = config.running_text;
                
                // Update Logo jika ada
                if(config.logo) {
                    const logoDiv = document.querySelector('.w-14.h-14');
                    logoDiv.innerHTML = `<img src="${config.logo}" class="w-full h-full object-contain">`;
                    logoDiv.classList.remove('bg-emerald-600'); // hapus background ijo emoji
                }
            }

            // 3. Proses Slide & Jadwal Sholat
            processData(data);
            await initPrayerTimes(); // Panggil API Sholat menggunakan config.wilayah_sholat
            
            document.getElementById('loading').style.display = 'none';
        } catch (e) {
            console.error("Gagal inisialisasi:", e);
        }
    }

    async function initPrayerTimes() {
        // Gunakan variabel dari config hasil download JSON
        const city = config.wilayah_sholat || 'Bekasi';
        const method = config.metode_api || '11';

        try {
            const res = await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Indonesia&method=${method}`);
            const json = await res.json();
            const d = json.data.timings;
            
            prayerTimes = {
                'imsak': d.Imsak, 'fajr': d.Fajr, 'dhuhr': d.Dhuhr, 
                'asr': d.Asr, 'maghrib': d.Maghrib, 'isha': d.Isha
            };

            for (let k in prayerTimes) {
                document.getElementById('t-' + k).innerText = prayerTimes[k];
            }
        } catch(e) { console.error("Err Prayer API"); }
    }

    // Update fungsi IQOMAH agar menggunakan config.durasi_iqomah
    function updateClock() {
        // ... kode jam lainnya sama ...
        
        // Di bagian logika Iqomah:
        const iqDuration = config.durasi_iqomah * 60; // konversi menit ke detik
        if(diffSince >= 0 && diffSince < iqDuration) {
            activeIqomah = true;
            const rem = iqDuration - diffSince;
            // ... sisa kode timer iqomah ...
        }
    }

    // Jalankan Aplikasi
    initApp(); 
    setInterval(updateClock, 1000);
    setInterval(renderSlide, 15000);
    setInterval(initApp, 300000); // Refresh semua data tiap 5 menit


